{% comment %}
SPDX-License-Identifier: CC-BY-SA-4.0
SPDX-FileCopyrightText: 2020 seL4 Project a Series of LF Projects, LLC.
{% endcomment %}
{% assign page_url = page.url | split: "/" %}

<div class="sidebar">
{% for item in site.data.sidebar.toc %}
{% assign page_in_list = item.subfolderitems | where: "url", page.url | size %}
{% if page_in_list == 1 or page.url == item.url %}
      <ul class="nav nav-sidebar">
  {% for entry in item.subfolderitems %}
        <li class="{% if page.url == entry.url %}active{% endif %}">
          <a class="" href="../{{ entry.url }}">
            {{ entry.page }}
          </a>
        </li>
  {% endfor %}
      </ul>
{% endif %}
{% endfor %}


{% comment %}
The following logic is necessary to unfold the projects dict into an array.
Because the unfolding logic seems to triple the site build time, it is only
executed for production builds. This is all so the project links can be sorted
{% endcomment %}
{% assign projects = site.data.projects %}
{% if jekyll.environment == "production" %}
  {% assign new_projects = "" | split: "." %}
  {% for project_ in site.data.projects %}
    {% assign new_projects = new_projects | push: project_[1] %}
  {% endfor %}
  {% assign projects = new_projects | sort: 'project_order' %}
{% endif %}
{% assign page_in_list = site.data.sidebar.toc[0].subfolderitems | where: "url", page.url | size %}

{% if page_url[1] == "projects" and page_in_list != 1 %}
    <ul class="nav nav-sidebar">
  {% for project in projects %}
    {% assign new_project = "" | split: "." %}
    {% if jekyll.environment != "production" %}
      {% assign new_project = new_project | push: project[1] %}
    {% else %}
      {% assign new_project = new_project | push: project %}
    {% endif %}

    {% assign url = "/projects/" | append: new_project[0].name | append: '/' %}
        <li class="{% if page_url[2] == new_project[0].name %}active{% endif %}">
            <a class="" href="../{{url}}">{{new_project[0].display_name}}</a>
        <li>
  {% endfor %}
    </ul>
{% endif %}

{% if page_url[1] == "Tutorials" %}
  {% if page_url[2] contains "" %}
    {% assign url = "../" %}
  {% endif %}
  <ul class="nav nav-sidebar">
    <li>Getting started</li>
    <ul>
      <li><a href="{{url}}GettingStarted/about-seL4">About seL4</a></li>
      <li><a href="{{url}}GettingStarted/microkit">Using the seL4 Microkit tutorial to get started with seL4</a></li>
    </ul>
    <li>The seL4 kernel</li>
    <ul>
      <li><a href="{{url}}seL4Kernel/overview">Overview</a></li>
      <li><a href="{{url}}seL4Kernel/setting-up">Setting up your machine</a></li>
      <li><a href="{{url}}seL4Kernel/hello-world">Hello world</a></li>
      <li><a href="{{url}}seL4Kernel/capabilities">Capabilities</a></li>
      <li><a href="{{url}}seL4Kernel/untyped">Untyped</a></li>
      <li><a href="{{url}}seL4Kernel/mapping">Mapping</a></li>
      <li><a href="{{url}}seL4Kernel/threads">Threads</a></li>
      <li><a href="{{url}}seL4Kernel/ipc">IPC</a></li>
      <li><a href="{{url}}seL4Kernel/notifications">Notifications</a></li>
      <li><a href="{{url}}seL4Kernel/interrupts">Interrupts</a></li>
      <li><a href="{{url}}seL4Kernel/fault-handlers">Fault Handling</a></li>
    </ul>
    <li>MCS</li>
    <ul>
      <li><a href="{{url}}MCS/mcs">MCS Extensions</a></li>
    </ul>
    <li>Dynamic libraries</li>
    <ul>
      <li><a href="{{url}}DynamicLibraries/dynamic-1">Initialisation & threading</a></li>
      <li><a href="{{url}}DynamicLibraries/dynamic-2">IPC</a></li>
      <li><a href="{{url}}DynamicLibraries/dynamic-3">Processes & Elf loading</a></li>
      <li><a href="{{url}}DynamicLibraries/dynamic-4">Timer</a></li>
    </ul>
    <li>CAmkES</li>
    <ul>
      <li><a href="{{url}}CAmkES/hello-camkes-0">Hello CAmkES</a></li>
      <li><a href="{{url}}CAmkES/hello-camkes-1">CAmkES 1: Introduction to CAmkES</a></li>
      <li><a href="{{url}}CAmkES/hello-camkes-2">CAmkES 2: Events</a></li>
      <li><a href="{{url}}CAmkES/hello-camkes-timer">CAmkES 3: Timer</a></li>
      <li><a href="{{url}}CAmkES/camkes-vm-linux">CAmkES VM</a></li>
      <li><a href="{{url}}CAmkES/camkes-vm-crossvm">CAmkES Cross VM Connectors</a></li>
    </ul>
    <li>Microkit</li>
    <ul>
      <li><a href="https://trustworthy.systems/projects/microkit/tutorial/">Tutorial</a></li>
    </ul>
    <li>Rust</li>
    <ul>
      <li><a href= "https://github.com/seL4/rust-sel4">GitHub</a></li>
    </ul>
    <li>Resources</li>
    <ul>
      <li><a href="https://sel4.systems/Info/Docs/seL4-manual-latest.pdf">seL4 Manual</a></li>
      <li><a href= "/projects/sel4/api-doc.html">API references</a></li>
      <li><a href="{{url}}Resources/how-to"><em>How to:</em> A quick solutions guide</a></li>
      <li><a href="{{url}}../projects/sel4-tutorials/debugging-guide">Debugging guide</a></li>
      <li><a href="https://sel4.discourse.group/">Discourse forum</a></li>
      <li><a href="https://lists.sel4.systems/postorius/lists/devel.sel4.systems/">Developer mailing list</a></li>
      <li><a href="https://mattermost.trustworthy.systems/sel4-external/channels/web-doc-revamp">Mattermost channel</a></li>
    </ul>
  </ul>
{% endif %}
</div>